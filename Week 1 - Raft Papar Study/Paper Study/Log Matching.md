--- 
##### 로그 매칭
###### 요약
- 만약 두 로그가 동일한 인덱스와 동일한 임기 번호를 가진다면
- 해당 인덱스까지의 모든 엔트리가 동일함을 보장
- 동일한 명령을 저장할 것을 보장

###### Log란?
- 변경 사항등을 

###### Raft 로그 메커니즘
- 서버들의 로그 시퀸스 -> 높은 Coherency(통일성)를 갖도록 설계
- 시스템의 행동을 단순화하고 예측 가능하게
- 안정성 보장

Raft는 아래 Log Matching Property가 성립하도록 보장
```
- 만약 서로 다른 로그의 두 엔트리가 같은 index와 term 값을 가진다면 두 엔트리는 같은 명령을 저장한다.
- 만약 서로 다른 로그의 두 엔트리가 같은 index와 term 값을 가진다면 해당 엔트리 앞의 모든 엔트리들 또한 동일하다.
```
![[Pasted image 20240723105704.png]]
	- 리더가 주어진 `index`와 `term`에 대해 최대 1개의 엔트리를 만듦
	- 로그 엔트리들은 절대 그들의 위치를 바꾸지 않음
-> 만약 서로 다른 로그의 두 엔트리가 같은 index와 term 값을 가진다면 두 엔트리는 같은 명령을 저장한다.

- `AppendEntries` RPC를 수행할 때 간단한 일관성 검사를 수행함으로써 만족
- `AppendEntries` RPC를 보낼 때 리더는 새 엔트리의 바로 앞 엔트리의 `index` 및 `term` 값을 RPC에 포함
- 팔로워가 그들의 로그에서 같은 `index`와 `term` 값을 갖는 엔트리를 찾지 못하면 해당 `AppendEntries` RPC는 거절
- 이로 인해 `Log Matching Property` 충족
-> 만약 서로 다른 로그의 두 엔트리가 같은 index와 term 값을 가진다면 해당 엔트리 앞의 모든 엔트리들 또한 동일하다.

로그의 초기 상태는 `Log Matching Property`를 만족한다. 그리고 위 `AppendEntries`의 일관성 검사에 의해 로그가 늘어날 때 마다 `Log Matching Property`가 보존된다. 결과적으로 `AppendEntries`가 성공적으로 리턴될 때 마다 리더는 각 팔로워들의 로그가 자신의 로그와 추가된 새 엔트리 항목까지 동일할 것이라는 것을 알 수 있다.